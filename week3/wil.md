스프링 계층형 어키텍쳐
컨트롤러
서비스
레포지토리
엔티티
로 나뉜다

레포지토리는 crud작업을 진행

레포지토리가 db에 접근하려면 sql로 조회한다.
여러 방식이 있어 이걸 도와주는 것이 jdbc api다.
하지만 jdbc처럼 sql을 직접 작성하는 건 불편하다. 또한 객체-db
패러다임이 일치하지 않는다.

따라서 orm을 사용한다.
갹체와 db테이블을 자동으로 매핑해 sql을 자동으로 작성해준다.
jpa는 자바의 orm표쥰
jpa로 레포지토리 계층을 구현한다

엔티티 매니저는 엔티티 객체를 db와 연결해준다. 앤티티를 영속성 컨텍스트에 저장해 관리한다

영속성 컨텍스트
jpa에서 엔티티를 관리하기 위해 만들어진 가상공간
엔티티 매니저를 통해 영속성 컨텍스트에 접근
엔티티생명주기가 있다.
비영속 영속 준영속 삭제
영속성 컨텍스의 특징
1차 캐시(한 번 조회한 객체를 내부에 저장해놓고 재사용
동일성 보장(트랜잭션 안에서는 같은 엔티티를 여러번 조회해도 항상 동일한 객체임이 보장)
트랜잭션(db에서 수행되는 작업의 단위)을 지원하는 쓰기지연
변경감지(트랜잭션이 끝나기 전까지는 변경사항을 db에 반영하지 않음. 컨텍스트가 관리하는 영속상태의 엔티티에만 적용)

쓰기 지연
엔티티를 비영속상태 ->영속상태, 등록을 위한 sql이 저장된다.
이 후 변경사항을 모아두었다가 트랜잭션 커밋
=> 성능 최적화
